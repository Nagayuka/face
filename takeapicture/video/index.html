<!DOCTYPE html>
<html>
  <head>
    <title>3秒間ビデオ録画</title>
  </head>
  <body>
    <video id="video" width="640" height="480" autoplay></video>
    <button id="startButton">スタート</button>
    <script>
      const startButton = document.getElementById("startButton");
      const videoElement = document.getElementById("video");
      let mediaRecorder;
      let recordedChunks = [];

      async function startRecording() {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({
            video: true,
            audio: true,
          });
          videoElement.srcObject = stream;
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
              recordedChunks.push(event.data);
            }
          };

          mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: "video/webm" });
            recordedChunks = [];
            const url = URL.createObjectURL(blob);
            const replayVideo = document.createElement("video");
            replayVideo.controls = true;
            replayVideo.src = url;
            document.body.appendChild(replayVideo);
          };
        } catch (error) {
          console.error(
            "メディアストリームの取得中にエラーが発生しました:",
            error
          );
        }
      }

      startButton.addEventListener("click", () => {
        startRecording();
        setTimeout(() => {
          mediaRecorder.stop();
        }, 3000); // 3秒間録画
      });
    </script>
  </body>
</html>
